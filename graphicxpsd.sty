\ProvidesPackage{graphicxpsd}
  [2017/10/16 v0.4  Supporting Adobe Photoshop format (PSD) for graphicx with sips command]

%% support the extension .psd
\@namedef{Gin@rule@.PSD}#1{{psd}{.xbb}{#1}}
\@namedef{Gin@rule@.psd}#1{{psd}{.xbb}{#1}}

%% include .psd file
\let\Ginclude@psd\Ginclude@bmp

%% compatibility for TL2016 or lower version
\@ifundefined{GPT@space}{%
  \def\GPT@space{ }%
}{}

%% read .psd file
\let\clone@Gread@pdf\Gread@pdf
\def\Gread@psd#1{%
  \typeout{converting: \Gin@base\Gin@ext\space -> \Gin@base.png}%
  \immediate\write18{sips -s format png \Gin@base\Gin@ext\GPT@space --out \Gin@base4dpx.png}%
  %% renamed inside: foo.psd -> foo4dpx.png
  \let\clone@Gin@base\Gin@base
  \def\Gin@base{\clone@Gin@base4dpx}%
  \def\Gin@ext{.png}%
% \typeout{!!! #1}%%=> tigerpsdfmt4dpx.xbb
% \typeout{!!! \Gin@base\Gin@ext}%%=> tigerpsdfmt4dpx.png
  \clone@Gread@pdf{#1}}

\endinput
